## Migrate kubernetes-client v9 â†’ v10+

### Context
All remaining npm audit findings (14 vulnerabilities: 5 moderate, 9 critical) stem from `kubernetes-client@9.0.0` dependencies in the `@neonhub/predictive-engine` module.

### Affected Packages
- `kubernetes-client@9.0.0`
- `@kubernetes/client-node@0.18.1`
- Vulnerable transitive deps: form-data, jsonpath-plus (RCE), request, got, jose, tough-cookie, swagger-fluent, openid-client

### Security Issues
| Package | Severity | CVE/Advisory |
|---------|----------|--------------|
| jsonpath-plus | Critical | RCE vulnerabilities (2) |
| form-data | Critical | Unsafe random boundary |
| protobufjs | Critical | Prototype pollution |
| request | Multiple | Deprecated, multiple vulns |
| tough-cookie | Moderate | Prototype pollution |
| got | Moderate | UNIX socket redirect |
| jose | Moderate | Resource exhaustion |

### Migration Plan

#### 1. Research Phase
- [ ] Review kubernetes-client v10+ breaking changes
- [ ] Check @kubernetes/client-node v1.0+ compatibility
- [ ] Identify all cluster operation usage in predictive-engine
- [ ] Document API differences

#### 2. Update Dependencies
```json
{
  "kubernetes-client": "^10.0.0",
  "@kubernetes/client-node": "^1.0.0"
}
```

#### 3. Code Migration
- [ ] Update client initialization patterns
- [ ] Refactor API calls for v10 compatibility
- [ ] Update type definitions
- [ ] Fix any breaking changes in:
  - `modules/predictive-engine/src/scaling/KubernetesManager.ts`
  - Any cloud integration files using k8s client

#### 4. Testing
- [ ] Unit tests pass
- [ ] Integration tests with mock k8s cluster
- [ ] Verify cluster operations work in staging
- [ ] Load test auto-scaling behavior

#### 5. Cleanup
- [ ] Remove `security/audit-allowlist.json`
- [ ] Run `npm audit` to verify 0 vulnerabilities
- [ ] Update security documentation

### Temporary Mitigation
Currently using audit allowlist in CI:
```json
// security/audit-allowlist.json
{
  "allowlist": ["kubernetes-client@9", ...]
}
```
**Remove this file after migration.**

### Evaluation Alternative
If kubernetes-client proves difficult to migrate:
- Consider moving to official `@kubernetes/client-node` only
- Or evaluate if k8s features are actively used
- If unused, remove dependency entirely

### Priority
**Medium-High**: Security vulnerabilities present but mitigated by:
- Not internet-exposed (internal cluster ops only)
- Requires cluster access to exploit
- Allowlist documented for audit compliance

### Estimated Effort
- Research: 2-4 hours
- Migration: 4-8 hours  
- Testing: 4-6 hours
**Total: 1-2 days**

### Related
- PR #XX: Security fixes that documented this issue
- Report: `reports/SECURITY_FIX_REPORT.md`
- Audit snapshot: `reports/AUDIT_SNAPSHOT_2025-10-21.txt`

### Acceptance Criteria
- [ ] kubernetes-client upgraded to v10+
- [ ] All tests passing
- [ ] `npm audit` shows 0 vulnerabilities (or <10 low)
- [ ] Audit allowlist removed
- [ ] Documentation updated
- [ ] Cluster operations verified in staging

---
**Labels:** `security`, `dependencies`, `predictive-engine`, `priority:medium-high`

