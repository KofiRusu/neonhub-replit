{"file":"/Users/kofirusu/Desktop/NeonHub/apps/api/src/config/env.ts","mappings":"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","names":[],"sources":["/Users/kofirusu/Desktop/NeonHub/apps/api/src/config/env.ts"],"sourcesContent":["import { z } from 'zod';\n\nconst envSchema = z.object({\n  // Database\n  DATABASE_URL: z.string().url('DATABASE_URL must be a valid URL'),\n  \n  // Authentication  \n  NEXTAUTH_SECRET: z.string().min(32, 'NEXTAUTH_SECRET must be at least 32 characters'),\n  NEXTAUTH_URL: z.string().url('NEXTAUTH_URL must be a valid URL'),\n  \n  // CORS\n  CORS_ORIGINS: z.string().min(1, 'CORS_ORIGINS must be provided').transform((val) => \n    val.split(',').map(origin => origin.trim()).filter(Boolean)\n  ),\n  \n  // Infrastructure\n  REDIS_URL: z.string().url().optional(),\n  \n  // Payment\n  STRIPE_SECRET_KEY: z.string().min(1, 'STRIPE_SECRET_KEY is required'),\n  STRIPE_WEBHOOK_SECRET: z.string().min(1, 'STRIPE_WEBHOOK_SECRET is required'),\n  \n  // External APIs\n  RESEND_API_KEY: z.string().min(1, 'RESEND_API_KEY is required'),\n  OPENAI_API_KEY: z.string().min(1, 'OPENAI_API_KEY is required'),\n  OPENAI_MODEL: z.string().default('gpt-4'),\n  \n  // Environment\n  NODE_ENV: z.enum(['development', 'production', 'test']).default('development'),\n  PORT: z.coerce.number().positive().default(3001),\n  \n  // Beta Program\n  BETA_ENABLED: z.coerce.boolean().default(false),\n  \n  // Optional - Monitoring\n  SENTRY_DSN: z.string().url().optional(),\n  \n  // Optional - SMS\n  TWILIO_ACCOUNT_SID: z.string().optional(),\n  TWILIO_SID: z.string().optional(),\n  TWILIO_AUTH_TOKEN: z.string().optional(), \n  TWILIO_PHONE_NUMBER: z.string().optional(),\n  \n  // Social APIs (for trends service)\n  TWITTER_BEARER_TOKEN: z.string().optional(),\n  REDDIT_CLIENT_ID: z.string().optional(),\n  REDDIT_CLIENT_SECRET: z.string().optional(),\n  REDDIT_USER_AGENT: z.string().default('NeonHub/3.2'),\n});\n\nexport type Env = z.infer<typeof envSchema>;\n\nlet hasWarnedNonProd = false;\n\nexport function validateEnv(): Env {\n  try {\n    return envSchema.parse(process.env);\n  } catch (error) {\n    if (error instanceof z.ZodError) {\n      const missingVars = error.errors.map(err => `${err.path.join('.')}: ${err.message}`).join('\\n');\n      console.error('❌ Environment validation failed:\\n' + missingVars);\n\n      const nodeEnv = (process.env.NODE_ENV ?? 'development').toLowerCase();\n      const isJestRuntime =\n        Boolean(process.env.JEST_WORKER_ID) ||\n        process.argv.some((arg) => arg.includes('jest'));\n\n      if (nodeEnv !== 'production' || isJestRuntime) {\n        if (!hasWarnedNonProd) {\n          console.warn(\n            '⚠️  Using relaxed environment defaults. Set required variables or run `npm run verify` before production deploys.'\n          );\n          hasWarnedNonProd = true;\n        }\n        return buildFallbackEnv(nodeEnv === 'test' || isJestRuntime ? 'test' : 'development');\n      }\n\n      throw new Error(`Environment validation failed:\\n${missingVars}`);\n    }\n    throw error;\n  }\n}\n\n// Singleton instance - skip strict validation in test mode\nlet _env: Env | null = null;\n\nfunction parseOrigins(raw?: string | string[]): string[] {\n  if (Array.isArray(raw)) {\n    return raw;\n  }\n  if (!raw) {\n    return ['http://localhost:3000'];\n  }\n  return raw\n    .split(',')\n    .map((origin) => origin.trim())\n    .filter(Boolean);\n}\n\nfunction buildFallbackEnv(target: 'test' | 'development'): Env {\n  const defaults = {\n    DATABASE_URL:\n      process.env.DATABASE_URL ||\n      (target === 'test'\n        ? 'postgresql://test:test@localhost:5432/test'\n        : 'postgresql://localhost:5432/neonhub'),\n    NEXTAUTH_SECRET:\n      process.env.NEXTAUTH_SECRET ||\n      (target === 'test'\n        ? 'test-secret-min-32-chars-long-12345'\n        : 'dev-secret-min-32-chars-long-12345'),\n    NEXTAUTH_URL: process.env.NEXTAUTH_URL || 'http://localhost:3000',\n    CORS_ORIGINS: parseOrigins(process.env.CORS_ORIGINS),\n    REDIS_URL: process.env.REDIS_URL || 'redis://localhost:6379',\n    STRIPE_SECRET_KEY:\n      process.env.STRIPE_SECRET_KEY ||\n      (target === 'test' ? 'sk_test_fake' : 'sk_test_dev'),\n    STRIPE_WEBHOOK_SECRET:\n      process.env.STRIPE_WEBHOOK_SECRET ||\n      (target === 'test' ? 'whsec_test_fake' : 'whsec_dev_fake'),\n    RESEND_API_KEY: process.env.RESEND_API_KEY || 'test_fake',\n    OPENAI_API_KEY:\n      process.env.OPENAI_API_KEY ||\n      (target === 'test'\n        ? 'test-key-for-testing'\n        : 'test-key-for-development'),\n    OPENAI_MODEL: process.env.OPENAI_MODEL || 'gpt-4',\n    NODE_ENV: target as 'test' | 'development' | 'production',\n    PORT: Number(process.env.PORT ?? 3001),\n    SENTRY_DSN: process.env.SENTRY_DSN,\n    TWILIO_ACCOUNT_SID: process.env.TWILIO_ACCOUNT_SID,\n    TWILIO_SID: process.env.TWILIO_SID || process.env.TWILIO_ACCOUNT_SID,\n    TWILIO_AUTH_TOKEN: process.env.TWILIO_AUTH_TOKEN,\n    TWILIO_PHONE_NUMBER: process.env.TWILIO_PHONE_NUMBER,\n  };\n\n  return defaults;\n}\n\nexport const env = (() => {\n  if (_env) return _env;\n  \n  const nodeEnv = (process.env.NODE_ENV ?? 'development').toLowerCase();\n  const isJestRuntime =\n    Boolean(process.env.JEST_WORKER_ID) ||\n    process.argv.some((arg) => arg.includes('jest'));\n  const isTest = nodeEnv === 'test' || isJestRuntime;\n\n  if (nodeEnv === 'production' && !isJestRuntime) {\n    _env = validateEnv();\n    return _env;\n  }\n\n  const parsed = envSchema.safeParse(process.env);\n  if (parsed.success) {\n    _env = {\n      ...parsed.data,\n      NODE_ENV: isTest ? 'test' : (parsed.data.NODE_ENV ?? 'development'),\n      CORS_ORIGINS: parseOrigins(process.env.CORS_ORIGINS),\n      PORT: Number(process.env.PORT ?? parsed.data.PORT ?? 3001),\n    };\n    return _env;\n  }\n\n  if (!hasWarnedNonProd) {\n    console.warn(\n      '⚠️  Using relaxed environment defaults. Set required variables or run `npm run verify` before production deploys.'\n    );\n    hasWarnedNonProd = true;\n  }\n\n  _env = buildFallbackEnv(isTest ? 'test' : 'development');\n  return _env;\n})();\n\n// Getter function for compatibility\nexport const getEnv = () => env;\n"],"version":3}