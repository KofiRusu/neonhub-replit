{"file":"/Users/kofirusu/Desktop/NeonHub/apps/api/src/connectors/__tests__/youtube-connector.test.ts","mappings":"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","names":[],"sources":["/Users/kofirusu/Desktop/NeonHub/apps/api/src/connectors/__tests__/youtube-connector.test.ts"],"sourcesContent":["import { describe, it, expect, beforeEach, jest, afterAll } from \"@jest/globals\";\nimport fs from \"node:fs\";\nimport { PassThrough } from \"node:stream\";\nimport { google } from \"googleapis\";\nimport { YouTubeConnector } from \"../services/YouTubeConnector.js\";\nimport { retryManager } from \"../execution/RetryManager.js\";\n\njest.mock(\"googleapis\", () => {\n  const insertMock = jest.fn();\n  const updateMock = jest.fn();\n  const listMock = jest.fn();\n\n  const youtubeMock = {\n    videos: {\n      insert: insertMock,\n      update: updateMock,\n      list: listMock,\n    },\n  } as unknown;\n\n  const authMock = {\n    OAuth2: jest.fn().mockImplementation(() => ({\n      setCredentials: jest.fn(),\n    })),\n  };\n\n  const googleMock = {\n    auth: authMock,\n    youtube: jest.fn().mockImplementation(() => youtubeMock),\n  };\n\n  return { google: googleMock, __esModule: true };\n});\n\njest.mock(\"node:fs\", () => ({\n  createReadStream: jest.fn(() => new PassThrough()),\n}));\n\nconst connector = new YouTubeConnector();\nconst runSpy = jest.spyOn(retryManager, \"run\");\nconst auth = {\n  accessToken: \"ya29.test\",\n  metadata: {\n    refreshToken: \"refresh-token\",\n    clientId: \"client-id\",\n    clientSecret: \"client-secret\",\n    channelId: \"channel-id\",\n  },\n};\n\nbeforeEach(() => {\n  (google.youtube as jest.Mock).mockClear();\n  runSpy.mockImplementation(async fn => fn());\n});\n\nafterAll(() => {\n  runSpy.mockRestore();\n});\n\ndescribe(\"YouTubeConnector\", () => {\n  it(\"uploads videos\", async () => {\n    const action = connector.actions.find(a => a.id === \"uploadVideo\");\n    if (!action) throw new Error(\"uploadVideo not found\");\n\n    const insertMock = jest.fn().mockImplementation(async () => ({ data: { id: \"yt_upload_123\", etag: \"etag\" } } as any));\n    (google.youtube as jest.Mock).mockReturnValueOnce({\n      videos: {\n        insert: insertMock,\n      },\n    } as any);\n\n    const result = await action.execute({\n      auth,\n      input: {\n        title: \"Launch Day\",\n        description: \"Highlights\",\n        videoFile: \"./fixtures/video.mp4\",\n        privacyStatus: \"public\",\n      },\n    });\n\n    expect(result).toEqual({ videoId: \"yt_upload_123\", etag: \"etag\" });\n    expect(insertMock).toHaveBeenCalled();\n  });\n\n  it(\"updates videos\", async () => {\n    const action = connector.actions.find(a => a.id === \"updateVideo\");\n    if (!action) throw new Error(\"updateVideo not found\");\n\n    const updateMock = jest.fn().mockImplementation(async () => ({ data: { id: \"yt_video_456\" } } as any));\n    (google.youtube as jest.Mock).mockReturnValueOnce({\n      videos: {\n        update: updateMock,\n      },\n    } as any);\n\n    const result = await action.execute({\n      auth,\n      input: {\n        videoId: \"yt_video_456\",\n        title: \"New Title\",\n      },\n    });\n\n    expect(result).toEqual({ id: \"yt_video_456\" });\n    expect(updateMock).toHaveBeenCalled();\n  });\n\n  it(\"retrieves video stats\", async () => {\n    const action = connector.actions.find(a => a.id === \"getVideoStats\");\n    if (!action) throw new Error(\"getVideoStats not found\");\n\n    const listMock = jest.fn().mockImplementation(async () => ({\n      data: {\n        items: [\n          {\n            statistics: {\n              viewCount: \"1024\",\n              likeCount: \"512\",\n              commentCount: \"12\",\n            },\n          },\n        ],\n      },\n    } as any));\n    (google.youtube as jest.Mock).mockReturnValueOnce({\n      videos: {\n        list: listMock,\n      },\n    } as any);\n\n    const result = await action.execute({\n      auth,\n      input: { videoId: \"yt_video_789\" },\n    });\n\n    expect(result).toEqual({ views: 1024, likes: 512, comments: 12 });\n    expect(listMock).toHaveBeenCalled();\n  });\n});\n"],"version":3}