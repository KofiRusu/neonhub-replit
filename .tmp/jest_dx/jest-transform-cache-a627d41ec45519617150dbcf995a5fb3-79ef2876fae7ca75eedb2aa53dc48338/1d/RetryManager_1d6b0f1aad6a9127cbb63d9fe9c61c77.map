{"file":"/Users/kofirusu/Desktop/NeonHub/apps/api/src/connectors/execution/RetryManager.ts","mappings":";;;AAAA,8CAAsD;AACtD,mDAA6C;AAQ7C,MAAa,YAAY;IACvB,YAA6B,UAAwB,EAAE;QAA1B,YAAO,GAAP,OAAO,CAAmB;QACrD,IAAI,CAAC,OAAO,GAAG;YACb,OAAO,EAAE,OAAO,CAAC,OAAO,IAAI,CAAC;YAC7B,cAAc,EAAE,OAAO,CAAC,cAAc,IAAI,IAAI;YAC9C,MAAM,EAAE,OAAO,CAAC,MAAM,IAAI,CAAC;SAC5B,CAAC;IACJ,CAAC;IAED,KAAK,CAAC,GAAG,CAAI,EAAoB;QAC/B,IAAI,OAAO,GAAG,CAAC,CAAC;QAChB,MAAM,EAAE,OAAO,EAAE,cAAc,EAAE,MAAM,EAAE,GAAG,IAAI,CAAC,OAAO,CAAC;QAEzD,iDAAiD;QACjD,OAAO,IAAI,EAAE,CAAC;YACZ,IAAI,CAAC;gBACH,OAAO,MAAM,EAAE,EAAE,CAAC;YACpB,CAAC;YAAC,OAAO,KAAK,EAAE,CAAC;gBACf,OAAO,IAAI,CAAC,CAAC;gBACb,IAAI,OAAO,GAAG,CAAC,OAAO,IAAI,CAAC,CAAC,EAAE,CAAC;oBAC7B,MAAM,KAAK,CAAC;gBACd,CAAC;gBACD,MAAM,IAAI,GAAG,CAAC,cAAc,IAAI,IAAI,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,MAAM,IAAI,CAAC,EAAE,OAAO,GAAG,CAAC,CAAC,CAAC;gBAC3E,kBAAM,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,IAAI,EAAE,EAAE,4CAA4C,CAAC,CAAC;gBAC7E,MAAM,IAAA,qBAAK,EAAC,IAAI,CAAC,CAAC;YACpB,CAAC;QACH,CAAC;IACH,CAAC;CACF;AA5BD,oCA4BC;AAEY,QAAA,YAAY,GAAG,IAAI,YAAY,EAAE,CAAC","names":[],"sources":["/Users/kofirusu/Desktop/NeonHub/apps/api/src/connectors/execution/RetryManager.ts"],"sourcesContent":["import { setTimeout as delay } from \"timers/promises\";\nimport { logger } from \"../../lib/logger.js\";\n\nexport interface RetryOptions {\n  retries?: number;\n  initialDelayMs?: number;\n  factor?: number;\n}\n\nexport class RetryManager {\n  constructor(private readonly options: RetryOptions = {}) {\n    this.options = {\n      retries: options.retries ?? 3,\n      initialDelayMs: options.initialDelayMs ?? 1000,\n      factor: options.factor ?? 2,\n    };\n  }\n\n  async run<T>(fn: () => Promise<T>): Promise<T> {\n    let attempt = 0;\n    const { retries, initialDelayMs, factor } = this.options;\n\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n      try {\n        return await fn();\n      } catch (error) {\n        attempt += 1;\n        if (attempt > (retries ?? 0)) {\n          throw error;\n        }\n        const wait = (initialDelayMs ?? 1000) * Math.pow(factor ?? 2, attempt - 1);\n        logger.warn({ attempt, wait }, \"Retrying connector operation after failure\");\n        await delay(wait);\n      }\n    }\n  }\n}\n\nexport const retryManager = new RetryManager();\n"],"version":3}