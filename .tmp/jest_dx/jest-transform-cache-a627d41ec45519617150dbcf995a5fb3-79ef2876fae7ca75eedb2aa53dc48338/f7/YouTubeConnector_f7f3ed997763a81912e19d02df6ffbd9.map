{"file":"/Users/kofirusu/Desktop/NeonHub/apps/api/src/connectors/services/YouTubeConnector.ts","mappings":"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","names":[],"sources":["/Users/kofirusu/Desktop/NeonHub/apps/api/src/connectors/services/YouTubeConnector.ts"],"sourcesContent":["import { google } from \"googleapis\";\nimport fs from \"node:fs\";\nimport { PassThrough } from \"node:stream\";\nimport { z } from \"zod\";\nimport { Connector } from \"../base/Connector.js\";\nimport type { ConnectorAuthContext } from \"../base/types.js\";\nimport { retryManager } from \"../execution/RetryManager.js\";\n\nconst youtubeCredentialsSchema = z.object({\n  accessToken: z.string().min(1, \"Google access token is required\"),\n  refreshToken: z.string().min(1, \"Google refresh token is required\"),\n  clientId: z.string().min(1, \"Google client ID is required\"),\n  clientSecret: z.string().min(1, \"Google client secret is required\"),\n  channelId: z.string().min(1, \"YouTube channel ID is required\"),\n});\n\nconst uploadVideoSchema = z.object({\n  title: z.string().min(1),\n  description: z.string().default(\"\"),\n  videoFile: z.string().min(1, \"Video file path is required\"),\n  privacyStatus: z.enum([\"public\", \"private\", \"unlisted\"]).default(\"private\"),\n});\n\nconst updateVideoSchema = z.object({\n  videoId: z.string().min(1),\n  title: z.string().optional(),\n  description: z.string().optional(),\n  tags: z.array(z.string()).optional(),\n  categoryId: z.string().optional(),\n});\n\nconst statsSchema = z.object({\n  videoId: z.string().min(1),\n});\n\ninterface YouTubeCredentials {\n  accessToken: string;\n  refreshToken: string;\n  clientId: string;\n  clientSecret: string;\n  channelId: string;\n}\n\nfunction resolveCredentials(auth: ConnectorAuthContext): YouTubeCredentials {\n  const metadata = auth.metadata ?? {};\n  const parsed = youtubeCredentialsSchema.safeParse({\n    accessToken: auth.accessToken ?? metadata.accessToken,\n    refreshToken: metadata.refreshToken,\n    clientId: metadata.clientId,\n    clientSecret: metadata.clientSecret,\n    channelId: metadata.channelId,\n  });\n\n  if (!parsed.success) {\n    throw new Error(parsed.error.errors.map(err => err.message).join(\", \"));\n  }\n\n  return parsed.data as YouTubeCredentials;\n}\n\nfunction createYouTubeClient(creds: YouTubeCredentials) {\n  const oauth2Client = new google.auth.OAuth2({\n    clientId: creds.clientId,\n    clientSecret: creds.clientSecret,\n  });\n  oauth2Client.setCredentials({\n    access_token: creds.accessToken,\n    refresh_token: creds.refreshToken,\n  });\n  return google.youtube({ version: \"v3\", auth: oauth2Client });\n}\n\nasync function uploadVideo(creds: YouTubeCredentials, params: z.infer<typeof uploadVideoSchema>) {\n  const youtube = createYouTubeClient(creds);\n\n  const fileStream = fs.createReadStream(params.videoFile);\n  const passthrough = new PassThrough();\n  fileStream.pipe(passthrough);\n\n  const response = await youtube.videos.insert({\n    part: [\"snippet\", \"status\"],\n    requestBody: {\n      snippet: {\n        title: params.title,\n        description: params.description,\n        channelId: creds.channelId,\n      },\n      status: {\n        privacyStatus: params.privacyStatus,\n      },\n    },\n    media: {\n      body: passthrough,\n    },\n  });\n\n  return response.data;\n}\n\nasync function updateVideo(creds: YouTubeCredentials, params: z.infer<typeof updateVideoSchema>) {\n  const youtube = createYouTubeClient(creds);\n  const response = await youtube.videos.update({\n    part: [\"snippet\"],\n    requestBody: {\n      id: params.videoId,\n      snippet: {\n        title: params.title,\n        description: params.description,\n        tags: params.tags,\n        categoryId: params.categoryId,\n      },\n    },\n  });\n\n  return response.data;\n}\n\nasync function getVideoStatistics(creds: YouTubeCredentials, videoId: string) {\n  const youtube = createYouTubeClient(creds);\n  const response = await youtube.videos.list({\n    id: [videoId],\n    part: [\"statistics\"],\n  });\n\n  const item = response.data.items?.[0];\n  if (!item?.statistics) {\n    return {};\n  }\n  return {\n    views: Number(item.statistics.viewCount ?? 0),\n    likes: Number(item.statistics.likeCount ?? 0),\n    comments: Number(item.statistics.commentCount ?? 0),\n  };\n}\n\nexport class YouTubeConnector extends Connector {\n  constructor() {\n    super({\n      name: \"youtube\",\n      displayName: \"YouTube\",\n      description: \"Upload videos and manage metadata via the YouTube Data API.\",\n      category: \"social\",\n      iconUrl: \"https://www.youtube.com/s/desktop/6f3e1dba/img/favicon_32x32.png\",\n      websiteUrl: \"https://www.youtube.com\",\n      authType: \"oauth2\",\n      authConfig: {\n        authorizeUrl: \"https://accounts.google.com/o/oauth2/v2/auth\",\n        tokenUrl: \"https://oauth2.googleapis.com/token\",\n        scopes: [\n          \"https://www.googleapis.com/auth/youtube.upload\",\n          \"https://www.googleapis.com/auth/youtube\",\n          \"https://www.googleapis.com/auth/youtube.readonly\",\n        ],\n      },\n    });\n  }\n\n  private getCredentials(auth: ConnectorAuthContext) {\n    return resolveCredentials(auth);\n  }\n\n  actions = [\n    {\n      id: \"uploadVideo\",\n      name: \"Upload Video\",\n      description: \"Upload a new video to YouTube using resumable upload.\",\n      inputSchema: uploadVideoSchema,\n      execute: async ({ auth, input }) => {\n        const creds = this.getCredentials(auth);\n        const payload = uploadVideoSchema.parse(input);\n\n        const video = await retryManager.run(() => uploadVideo(creds, payload));\n        return {\n          videoId: video.id,\n          etag: video.etag,\n        };\n      },\n    },\n    {\n      id: \"updateVideo\",\n      name: \"Update Video Metadata\",\n      description: \"Update details for an existing YouTube video.\",\n      inputSchema: updateVideoSchema,\n      execute: async ({ auth, input }) => {\n        const creds = this.getCredentials(auth);\n        const payload = updateVideoSchema.parse(input);\n        const result = await retryManager.run(() => updateVideo(creds, payload));\n        return result;\n      },\n    },\n    {\n      id: \"getVideoStats\",\n      name: \"Get Video Stats\",\n      description: \"Retrieve statistics for a YouTube video.\",\n      inputSchema: statsSchema,\n      execute: async ({ auth, input }) => {\n        const creds = this.getCredentials(auth);\n        const payload = statsSchema.parse(input);\n        const stats = await retryManager.run(() => getVideoStatistics(creds, payload.videoId));\n        return stats;\n      },\n    },\n  ];\n\n  triggers = [];\n\n  async testConnection(auth: ConnectorAuthContext): Promise<boolean> {\n    try {\n      const creds = this.getCredentials(auth);\n      await retryManager.run(() => getVideoStatistics(creds, \"dQw4w9WgXcQ\"));\n      return true;\n    } catch {\n      return false;\n    }\n  }\n}\n"],"version":3}